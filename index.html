<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DutyPlanner Pro - Secure Edition</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        :root {
            --primary: #4361ee;
            --dark-red: #8b0000;
            --bg: #f8f9fd;
            --sidebar-bg: #1e1e2d;
            --weekend-bg: #fff5f5;
        }

        body { font-family: 'Inter', sans-serif; background: var(--bg); margin: 0; display: flex; height: 100vh; overflow: hidden; }

        /* Sidebar & Layout */
        #sidebar { width: 320px; background: var(--sidebar-bg); color: white; padding: 20px; overflow-y: auto; display: none; }
        #main { flex-grow: 1; padding: 20px; overflow-y: auto; }
        #right-panel { width: 320px; padding: 20px; background: white; border-left: 1px solid #ddd; display: none; flex-direction: column; }

        .admin-active #sidebar, .admin-active #right-panel { display: flex; }
        .admin-active #sidebar { display: block; }

        input { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; padding: 10px; border-radius: 6px; width: 100%; box-sizing: border-box; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); max-width: 900px; margin: 0 auto; }
        
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #ddd; padding: 12px; }
        .weekend { background-color: var(--weekend-bg); color: #ef233c; }

        .login-btn { position: fixed; bottom: 10px; right: 10px; opacity: 0.1; cursor: pointer; background: none; border: none; font-size: 10px; }
        .btn { padding: 12px; border-radius: 8px; border: none; cursor: pointer; font-weight: 600; width: 100%; margin-top: 5px; }
        .btn-primary { background: var(--primary); color: white; }
    </style>
</head>
<body>

<div id="sidebar">
    <h2 style="text-align:center">ğŸ›  áƒáƒ“áƒ›áƒ˜áƒœ áƒáƒáƒœáƒ”áƒšáƒ˜</h2>
    <label>ğŸ“… áƒáƒ”áƒ áƒ˜áƒáƒ“áƒ˜</label>
    <input type="month" id="startMonth">
    <input type="month" id="endMonth" style="margin-top:5px">
    <hr style="opacity:0.2">
    <input type="text" id="staffName" placeholder="áƒ¡áƒáƒ®áƒ”áƒšáƒ˜">
    <input type="text" id="staffPhone" placeholder="áƒ¢áƒ”áƒšáƒ”áƒ¤áƒáƒœáƒ˜" style="margin-top:5px">
    <button class="btn btn-primary" onclick="addStaff()">áƒ“áƒáƒ›áƒáƒ¢áƒ”áƒ‘áƒ</button>
    <div id="staffListUI" style="margin-top:10px"></div>
    <button class="btn btn-primary" style="background:#2ecc71" onclick="generateNew()">ğŸ”„ áƒ’áƒ”áƒœáƒ”áƒ áƒ˜áƒ áƒ”áƒ‘áƒ</button>
    <button class="btn" style="background:#e74c3c; color:white;" onclick="location.reload()">ğŸ”’ áƒ’áƒáƒ›áƒáƒ¡áƒ•áƒšáƒ</button>
</div>

<div id="main">
    <div class="card">
        <div id="displayTitle" style="color:var(--dark-red); text-align:center; font-size:24px; font-weight:800; margin-bottom:15px">áƒ¡áƒáƒ›áƒ£áƒ¨áƒáƒ áƒ’áƒáƒœáƒ áƒ˜áƒ’áƒ˜</div>
        <div id="displayHeaderPhone" style="text-align:center; margin-bottom:15px"></div>
        <div id="adminInputs" style="display:none; gap:10px; margin-bottom:15px">
            <input type="text" id="topTitleInput" placeholder="áƒ¡áƒáƒ—áƒáƒ£áƒ áƒ˜" oninput="updateUI()" style="color:#333; background:#eee">
            <input type="text" id="topPhoneInput" placeholder="áƒœáƒáƒ›áƒ áƒ”áƒ‘áƒ˜" oninput="updateUI()" style="color:#333; background:#eee">
        </div>
        <div id="scheduleContainer"></div>
    </div>
</div>

<div id="right-panel">
    <h3>ğŸ’» áƒ™áƒáƒ“áƒ˜</h3>
    <textarea id="codeOutput" style="flex-grow:1; background:#1e1e1e; color:#4ade80; padding:10px; font-family:monospace; font-size:11px;"></textarea>
    <button class="btn btn-primary" onclick="copyHTML()">ğŸ“‹ áƒ™áƒáƒáƒ˜áƒ áƒ”áƒ‘áƒ</button>
</div>

<button class="login-btn" onclick="secureLogin()">ğŸ”‘ Admin</button>

<script>
    // áƒ°áƒ”áƒ¨áƒ˜áƒ áƒ”áƒ‘áƒ£áƒšáƒ˜ áƒ›áƒáƒœáƒáƒªáƒ”áƒ›áƒ”áƒ‘áƒ˜ (Source-áƒ¨áƒ˜ áƒáƒ  áƒ©áƒáƒœáƒ¡ áƒ—áƒ¥áƒ•áƒ”áƒœáƒ˜ áƒáƒáƒ áƒáƒšáƒ˜)
    const H_USER = "82943716d26735ef217036d655f4486d34e9d568600f1352e800c73e0f9b6c00"; // "áƒ£áƒ©áƒ"-áƒ¡ áƒ°áƒ”áƒ¨áƒ˜
    const H_PASS = "4b84179326e63283995f00e5a95449755f1f33f8158c30678d781b4f4c20793a"; // "20261"-áƒ¡ áƒ°áƒ”áƒ¨áƒ˜

    function secureLogin() {
        const u = prompt("áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒ”áƒšáƒ˜:");
        const p = prompt("áƒáƒáƒ áƒáƒšáƒ˜:");
        
        if (u && p) {
            const uHash = CryptoJS.SHA256(u).toString();
            const pHash = CryptoJS.SHA256(p).toString();

            if (uHash === H_USER && pHash === H_PASS) {
                document.body.classList.add('admin-active');
                document.getElementById('adminInputs').style.display = 'flex';
                renderStaffUI();
            } else {
                alert("áƒ›áƒáƒœáƒáƒªáƒ”áƒ›áƒ”áƒ‘áƒ˜ áƒáƒ áƒáƒ¡áƒ¬áƒáƒ áƒ˜áƒ!");
            }
        }
    }

    let staff = JSON.parse(localStorage.getItem('savedStaffContacts')) || [];

    function addStaff() {
        const n = document.getElementById('staffName'), p = document.getElementById('staffPhone');
        if(n.value.trim()) {
            staff.push({ name: n.value.trim(), phone: p.value.trim() || "" });
            staff.sort((a, b) => a.name.localeCompare(b.name, 'ka'));
            localStorage.setItem('savedStaffContacts', JSON.stringify(staff));
            n.value = ""; p.value = ""; renderStaffUI();
        }
    }

    function renderStaffUI() {
        document.getElementById('staffListUI').innerHTML = staff.map((s, i) => `
            <div style="background:rgba(255,255,255,0.1); padding:8px; margin-bottom:5px; display:flex; justify-content:space-between; font-size:12px;">
                ${s.name} <span onclick="removeStaff(${i})" style="color:red; cursor:pointer;">Ã—</span>
            </div>`).join('');
    }

    function removeStaff(i) {
        staff.splice(i, 1);
        localStorage.setItem('savedStaffContacts', JSON.stringify(staff));
        renderStaffUI();
    }

    function updateUI() {
        const title = document.getElementById('topTitleInput').value || "áƒ¡áƒáƒ›áƒ£áƒ¨áƒáƒ áƒ’áƒáƒœáƒ áƒ˜áƒ’áƒ˜";
        const phones = document.getElementById('topPhoneInput').value;
        document.getElementById('displayTitle').innerText = title;
        const area = document.getElementById('displayHeaderPhone');
        area.innerHTML = phones.split(/[, ]+/).filter(x => x).map(p => `<a href="tel:${p}" style="display:inline-block; color:white; background:#8b0000; text-decoration:none; padding:8px 12px; border-radius:20px; margin:3px; font-size:13px;">ğŸ“ ${p}</a>`).join('');
        syncCode();
    }

    function generateNew() {
        const s = document.getElementById('startMonth').value;
        const e = document.getElementById('endMonth').value;
        if(!s || !e || staff.length === 0) return alert("áƒ¨áƒ”áƒáƒ•áƒ¡áƒ”áƒ— áƒ›áƒáƒœáƒáƒªáƒ”áƒ›áƒ”áƒ‘áƒ˜!");

        let cur = new Date(Date.UTC(s.split('-')[0], s.split('-')[1]-1, 1));
        const end = new Date(Date.UTC(e.split('-')[0], e.split('-')[1], 0));
        let html = "";
        let idx = 0;
        const months = ["áƒ˜áƒáƒœáƒ•áƒáƒ áƒ˜", "áƒ—áƒ”áƒ‘áƒ”áƒ áƒ•áƒáƒšáƒ˜", "áƒ›áƒáƒ áƒ¢áƒ˜", "áƒáƒáƒ áƒ˜áƒšáƒ˜", "áƒ›áƒáƒ˜áƒ¡áƒ˜", "áƒ˜áƒ•áƒœáƒ˜áƒ¡áƒ˜", "áƒ˜áƒ•áƒšáƒ˜áƒ¡áƒ˜", "áƒáƒ’áƒ•áƒ˜áƒ¡áƒ¢áƒ", "áƒ¡áƒ”áƒ¥áƒ¢áƒ”áƒ›áƒ‘áƒ”áƒ áƒ˜", "áƒáƒ¥áƒ¢áƒáƒ›áƒ‘áƒ”áƒ áƒ˜", "áƒœáƒáƒ”áƒ‘áƒ”áƒ áƒ˜", "áƒ“áƒ”áƒ™áƒ”áƒ›áƒ‘áƒ”áƒ áƒ˜"];

        while(cur <= end) {
            if(cur.getUTCDate() === 1) {
                if(html !== "") html += "</tbody></table>";
                html += `<h3 style="color:#8b0000; background:#f1f4f8; padding:10px">${months[cur.getUTCMonth()]} ${cur.getUTCFullYear()}</h3>
                         <table border="1" style="width:100%; border-collapse:collapse;"><thead><tr><th>áƒ“áƒ¦áƒ”</th><th>áƒ“áƒ áƒ</th><th>áƒ›áƒáƒ áƒ˜áƒ’áƒ”</th></tr></thead><tbody>`;
            }
            const isW = cur.getUTCDay() === 0 || cur.getUTCDay() === 6;
            const p = staff[idx % staff.length];
            html += `<tr class="${isW?'weekend':''}">
                <td><b>${cur.getUTCDate()}</b></td>
                <td>${isW?'08:00-03:00':'18:00-03:00'}</td>
                <td><b>${p.name}</b><br><small>${p.phone}</small></td></tr>`;
            idx++;
            cur.setUTCDate(cur.getUTCDate() + 1);
        }
        document.getElementById('scheduleContainer').innerHTML = html + "</tbody></table>";
        syncCode();
    }

    function syncCode() {
        const title = document.getElementById('displayTitle').innerText;
        const phones = document.getElementById('displayHeaderPhone').innerHTML;
        const content = document.getElementById('scheduleContainer').innerHTML;
        const finalHTML = `<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
        <style>body{font-family:sans-serif; padding:15px;} .weekend{background:#fff5f5; color:red;} table{width:100%; border-collapse:collapse;} td,th{padding:10px; border:1px solid #ddd;}</style>
        </head><body><h2 style="text-align:center; color:#8b0000;">${title}</h2><div style="text-align:center">${phones}</div>${content}</body></html>`;
        document.getElementById('codeOutput').value = finalHTML;
    }

    function copyHTML() {
        document.getElementById("codeOutput").select();
        document.execCommand("copy");
        alert("áƒ™áƒáƒ“áƒ˜ áƒ“áƒáƒ™áƒáƒáƒ˜áƒ áƒ“áƒ!");
    }
</script>
</body>
</html>
